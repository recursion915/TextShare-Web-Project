<html>
  <head>
    <title>Search Book</title>
      <script src="jquery-1.11.3.min.js"></script>
         <script type="text/javascript">


            
            $(document).ready(function() {
                              
              $("#firstname").html("Hello "+localStorage['firstname']+" "+localStorage['lastname']+"!");
              $("#username").html("Your username is "+localStorage['username']+".");
<!--          $("#password").html("Your password is "+localStorage['password']+".");-->
              $("#locationDiv").html("You live at "+localStorage['address']+".");
              $("#schoolDiv").html("You study at "+localStorage['university']+".");



                              
              (function poll(){
               setTimeout(function(){
                 $.ajax({
                                url:"bookedit/" + localStorage['username'],
                                type: "GET",
                                datatype: "json",
                                complete: poll,
                                success: function(data){
                                  if(data){
                                     for(i=0; i<data.length;i++){
                                        $('#bookrecord').append('<div id="div'+ i +'" onclick="bookdelete()" class="bookrecord"/>');
                                        $('#div'+ i ).html("Book Title: "+data[i].bookname+" ISBN: "+data[i].ISBN+" Price: "+"$"+data[i].price+" Condition: "+data[i].bookcondition+" Status: "+data[i].bookstatus);
                                        $('#div'+ i ).css('cursor','hand'); 
                                        localStorage.setItem('bookedit',JSON.stringify(data));

                                        }
                                      }
                                    
                                    else{
                                      console.log("No book record can be found");
                                    }
                                  },

                                });
                        }, 10);
                    })();


  
       



 
                              
              $("#Button_logout").click(function(){
                  localStorage.clear();
                  window.location.replace("signin.html");
                });
              $("#Button_bookcreate").click(function(){
                  window.location.replace("bookcreate.html");
                });
         

              
              


                  



              });


                        function bookdelete() {
              
                                          var index=(event.target.id).charAt(3);
                                          
                                          var deletedata= JSON.parse(localStorage.getItem("bookedit"));
                                          var r=confirm("Please confirm if you want to delete this record");
                                          if(r==true){
                                            
                                            $.ajax({
                                              url: "bookdelete/",
                                              type: "POST",
                                              datatype : "text",
                                              data:{
                                              id: deletedata[index].id,
                                              },
                                              success: function( data ) {
                                              console.log("You received some data!", data);
                                                if (data=='OK') {
                                                  $("#status").html("Record is deleted successfully!");
                                                  $(".bookrecord").remove();
                                                  search();
                                               



                                                }
                                                else{
                                                  $("#status").html("Error: Record cannot be deleted!");
                                                }
                                              },
                                            });
                                         
                                          }
                                        }

                function search() {                  
                                                                                   
                  $.ajax({
                                                              
                     url: "booksearch/" + $("#bookWanted").val(),
                     type: "GET",
                     dataType : "json",
                                     
                     success: function( data ) {
                                                           
                      if(typeof data[0] === 'undefined' && $("#bookWanted").val()!=""){
                        $('#searchResult').append('<div id="result0" />');
                        $('#result0').html("No record of books you searched for was found");}
                      else{
                        for(i=0; i<data.length;i++){                                    
                          $('#searchResult').append('<div id="result'+ i +'" />');
                          $('#result'+ i).html("Book Title: "+data[i].bookname+" ISBN: "+data[i].ISBN+" Price: "+"$"+data[i].price+" Condition: "+data[i].bookcondition);
                          $('#result'+ i).css('cursor','hand');
                          $('#result'+ i).click(function(event){
                            var index=(event.target.id).charAt(6);
                            window.location.href="bookdetails.html";
                            localStorage.setItem('searchresult',JSON.stringify(data[index]));
                                                           
                            });
                          }
                        }
                      },
                    });
               
                 }


            
                                        


               
                   


 


                             
            </script>
    </head>
    
    <body>
        <p>
        <button id="Button_logout">Log out</button>
        <button id="Button_bookcreate">Create Book Record</button>


        </p>
        <h1>Account information</h1>
        <div id="firstname"></div>
        <div id="username"></div>
<!--        <div id="password"></div>-->
        <div id="locationDiv"></div>
        <div id="schoolDiv"></div>
        <p></p>
        <h1>Book Records</h1>
        <div id="bookrecord"></div>
        <h1>Search</h1>
        <br>Search what book you want to rent(Title, ISBN):</br>
        <br>
        <input name="bookwanted" type=text size="30" id="bookWanted"/>
        <button id="search" onclick="search()">Search</button>
        </br>
        <p></p>
        <p></p>
        <div id="searchResult"></div>
        
        

        
    </body>
</html>


